<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GTA5 素材管理</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        h2 {
            border-left: 5px solid #f5a623;
            padding-left: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #444;
            padding: 5px;
            text-align: center;
        }

        input {
            width: 70px;
            background: #222;
            color: #fff;
            border: 1px solid #666;
        }

        .result {
            background: #1a1a1a;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <h1>GTA5 素材管理アプリ</h1>

    <h2>拠点素材</h2>
    <div id="base"></div>

    <h2>メンバー素材</h2>
    <div id="members"></div>

    <h2>クラフト数量入力</h2>
    <div id="craftInput"></div>

    <h2>必要素材合計</h2>
    <div id="result" class="result"></div>

    <script>
        const materials = ["鉄", "鋼鉄", "金属クズ", "銅", "布", "ラバー", "ガラス", "プラスチック"];
        const members = ["烏羽 爾亜", "青狐 ギルくん", "楠原 月雲", "青狐 ニス"];

        const recipes = {
            "スペシャルカービン": { "金属クズ": 120, "鉄": 250, "銅": 50, "鋼鉄": 150 },
            "Micro SMG": { "金属クズ": 50, "鉄": 100, "鋼鉄": 50 },
            "アタッチメント": { "金属クズ": 20, "銅": 20, "鋼鉄": 20 },
            "5.56弾": { "金属クズ": 10, "鉄": 5, "銅": 5 },
            "ヘビーアーマー": { "鋼鉄": 15, "布": 30, "ラバー": 10 },
            "グレネード": { "金属クズ": 50, "鉄": 20, "銅": 30 }
        };

        let data = JSON.parse(localStorage.getItem("gtaData")) || {
            base: {},
            members: {},
            craft: {}
        };

        function save() {
            localStorage.setItem("gtaData", JSON.stringify(data));
        }

        function createMaterialTable(container, obj, key) {
            let html = "<table><tr>";
            materials.forEach(m => html += `<th>${m}</th>`);
            html += "</tr><tr>";
            materials.forEach(m => {
                if (!obj[m]) obj[m] = 0;
                html += `<td><input type="number" value="${obj[m]}" onchange="updateValue('${key}','${m}',this.value)"></td>`;
            });
            html += "</tr></table>";
            container.innerHTML = html;
        }

        function updateValue(type, name, value, member = null) {
            value = parseInt(value) || 0;
            if (type === "base") data.base[name] = value;
            if (type === "member") data.members[member][name] = value;
            save();
            calculate();
        }

        function createMembers() {
            let html = "";
            members.forEach(mem => {
                if (!data.members[mem]) data.members[mem] = {};
                html += `<h3>${mem}</h3><div id="mem_${mem}"></div>`;
            });
            document.getElementById("members").innerHTML = html;
            members.forEach(mem => {
                createMaterialTable(
                    document.getElementById("mem_" + mem),
                    data.members[mem],
                    "member"
                );
            });
        }

        function createCraftInput() {
            let html = "<table><tr><th>アイテム</th><th>数量</th></tr>";
            for (let item in recipes) {
                if (!data.craft[item]) data.craft[item] = 0;
                html += `<tr><td>${item}</td>
    <td><input type="number" value="${data.craft[item]}" onchange="updateCraft('${item}',this.value)"></td></tr>`;
            }
            html += "</table>";
            document.getElementById("craftInput").innerHTML = html;
        }

        function updateCraft(item, value) {
            data.craft[item] = parseInt(value) || 0;
            save();
            calculate();
        }

        function calculate() {
            let totalNeed = {};
            materials.forEach(m => totalNeed[m] = 0);

            for (let item in data.craft) {
                let qty = data.craft[item];
                if (qty > 0) {
                    for (let mat in recipes[item]) {
                        totalNeed[mat] += recipes[item][mat] * qty;
                    }
                }
            }

            let totalHave = {};
            materials.forEach(m => {
                totalHave[m] = (data.base[m] || 0);
                members.forEach(mem => {
                    totalHave[m] += (data.members[mem][m] || 0);
                });
            });

            let html = "";
            materials.forEach(m => {
                let need = totalNeed[m] || 0;
                let have = totalHave[m] || 0;
                let diff = have - need;
                html += `${m} : 必要 ${need} / 所持 ${have} / ${diff >= 0 ? "余剰" : "不足"} ${Math.abs(diff)}<br>`;
            });

            document.getElementById("result").innerHTML = html;
        }

        createMaterialTable(document.getElementById("base"), data.base, "base");
        createMembers();
        createCraftInput();
        calculate();

        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js");
        }
    </script>

</body>

</html>
